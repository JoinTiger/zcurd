<#include "/common/head.html"/>

<table id="dg" class="easyui-datagrid" 
        data-options="
        	rownumbers:true,
        	fit:true,
        	border:false,
        	rownumbers:true,
        	singleSelect:true,
        	url:'genFormData',
        	method:'get',
        	toolbar:'#tb',
        	remoteSort:false,
            multiSort:true,
            collapsible:true,
        	pagination:false">
    <thead>
        <tr>
            <th data-options="field:'TABLE_SCHEMA',width:100">数据库</th>
            <th data-options="field:'TABLE_NAME',width:150">表名</th>
            <th data-options="field:'TABLE_COMMENT',width:150">表说明</th>
            <th data-options="field:'TABLE_TYPE',width:100">表类型</th>
            <th data-options="field:'formCount',width:100">已生成表单数</th>
        </tr>
    </thead>
</table>
<div id="tb" style="padding:2px 5px;">
    <div class="wrap_search">
        <span class="search_item" style="padding: 4px;">
            <span class="item_text">表名: </span>
            <span class="item_obj">
                <input class="easyui-textbox" type="text" id="TABLE_NAME" name="TABLE_NAME" onchange="search(this.value)"/>
            </span>    
        </span>
        <span class="search_item" style="padding: 4px;">
            <a href="#" class="easyui-linkbutton" iconCls="icon-search" onclick="go()">搜索</a>　　　　　　
        </span>
    </div>
</div>

<script type="text/javascript">
top.window.subPage.save = function() {
	var rowsSel = datagrid.datagrid("getSelections");
	if(rowsSel.length != 1) {
		showWarnMsg("请选择一条数据！");
		return;
	}
	$.post("genForm", {tableName: rowsSel[0].TABLE_NAME}, function(data) {
		if(data.result == "success") {
			showMsg("表单生成成功！");
			top.window.closeWindow();
			top.window.subPage.loadCurrDatagrid();
		}
	});	
}

var datagrid = $("#dg");
var rows = null;
function go() {
	var tableName = $("#TABLE_NAME").val();
	rows = rows || datagrid.datagrid("getData").rows;
	var filterRows = [];
	$.each(rows, function(i, item) {
		if(item.TABLE_NAME.indexOf(tableName) >= 0) {
			filterRows.push(item);
		}
	});
	datagrid.datagrid("loadData", filterRows);
}
</script>

<#include "/common/foot.html"/>